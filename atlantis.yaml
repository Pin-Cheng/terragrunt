version: 3

projects:
- name: vpc
  dir: infra/vpc
  autoplan:
    when_modified: ["**/*.hcl", "**/*.tf*"]
  workspace:
    name: "{{ .ProjectName }}-{{ .Workspace }}-{{ epoch }}"
    destroy_on_apply: true

# old setup
# version: 3
# projects:
# - name: vpc
#   dir: infra/vpc
#   autoplan:
#     when_modified: ["**/*.hcl", "**/*.tf*"]
#   vault:
#     address: "https://127.0.0.1:8200"
#     auth:
#       method: "token"
#       token: "{{ file `~/.vault-token` }}"
#     aws:
#       role: "atlantis"
#       session_ttl: "1h"
#       max_retries: 3
#       backoff: "exponential"
#       backoff_factor: 1.5

# - name: central-iam-roles
#   dir: central/basic/iam-roles
#   autoplan:
#     when_modified: ["**/*.hcl", "**/*.tf*"]
#   workflow: central

# - name: central-iam-users
#   dir: central/basic/iam-users
#   autoplan:
#     when_modified: ["**/*.hcl", "**/*.tf*"]
#   workflow: central

# - name: development-iam-roles
#   dir: development/basic/iam-roles
#   autoplan:
#     when_modified: ["**/*.hcl", "**/*.tf*"]
#   workflow: development

# - name: staging-iam-roles
#   dir: staging/basic/iam-roles
#   autoplan:
#     when_modified: ["**/*.hcl", "**/*.tf*"]
#   workflow: staging

# - name: production-iam-roles
#   dir: production/basic/iam-roles
#   autoplan:
#     when_modified: ["**/*.hcl", "**/*.tf*"]
#   workflow: production